<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Lesson 3 ‚Äì Determinants & Inversion | QuantQuest</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Roboto+Mono:wght@400;500&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary: #00ffcc;
      --secondary: #ffcc00;
      --bg-dark: #0b0c2a;
      --bg-light: #141632;
      --text-main: #ffffff;
      --text-dim: #cccccc;
      --danger: #ff4444;
    }
    body {
      background-color: var(--bg-dark);
      color: var(--text-main);
      font-family: 'Roboto Mono', monospace;
      padding: 2rem;
      max-width: 1200px;
      margin: 0 auto;
    }
    h1, h2, h3 {
      font-family: 'Press Start 2P', cursive;
      color: var(--primary);
      margin-bottom: 1rem;
    }
    .section {
      margin-bottom: 3rem;
      border-left: 4px solid var(--primary);
      padding-left: 1.5rem;
    }
    .card {
      background-color: var(--bg-light);
      border: 2px solid var(--primary);
      border-radius: 6px;
      padding: 1.2rem;
      margin-top: 1rem;
      box-shadow: 0 0 12px rgba(0, 255, 204, 0.15);
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    .card:hover {
      transform: translateY(-3px);
      box-shadow: 0 0 18px rgba(0, 255, 204, 0.3);
    }
    .checklist {
      list-style-type: none;
      padding-left: 0;
    }
    .checklist-item {
      padding: 0.8rem;
      margin: 0.5rem 0;
      background-color: rgba(20, 22, 50, 0.8);
      border-left: 3px solid var(--primary);
      display: flex;
      align-items: center;
      transition: background-color 0.2s;
    }
    .checklist-item input {
      margin-right: 1rem;
      width: 20px;
      height: 20px;
    }
    .checklist-item:hover {
      background-color: rgba(0, 255, 204, 0.05);
    }
    .completed {
      opacity: 0.7;
      border-left-color: var(--secondary);
      text-decoration: line-through;
    }
    .project-card {
      background-color: rgba(255, 204, 0, 0.1);
      border: 2px dashed var(--secondary);
      padding: 1rem;
      margin: 1rem 0;
    }
    .matrix-grid {
      display: inline-grid;
      grid-template-columns: repeat(3, auto);
      gap: 0.5rem;
      padding: 0.4rem 0.8rem;
      background-color: rgba(0, 255, 204, 0.05);
      border: 1px solid var(--primary);
    }
    .matrix-cell {
      min-width: 2rem;
      text-align: center;
    }
    .warning {
      color: var(--secondary);
      border-left: 3px solid var(--secondary);
      padding-left: 1rem;
      margin: 1rem 0;
    }
    .danger-warning {
      color: var(--danger);
      border-left: 3px solid var(--danger);
      padding-left: 1rem;
      margin: 1rem 0;
    }
    .btn {
      background-color: var(--primary);
      padding: 0.6rem 1.2rem;
      border: none;
      font-family: 'Press Start 2P', cursive;
      cursor: pointer;
      margin-top: 1rem;
      transition: background-color 0.2s;
    }
    .btn:hover {
      background-color: var(--secondary);
      color: var(--bg-dark);
    }
    /* Hidden solution style */
    .hidden-solution {
      display: none;
      margin-top: 1rem;
      padding: 1rem;
      background-color: rgba(0, 255, 204, 0.1);
      border-left: 3px solid var(--secondary);
    }
    .solution-btn {
      margin-top: 0.5rem;
      background-color: rgba(255, 204, 0, 0.2);
      padding: 0.4rem 1rem;
      border: none;
      font-family: 'Press Start 2P', cursive;
      cursor: pointer;
    }
    .solution-btn:hover {
      background-color: rgba(255, 204, 0, 0.4);
    }
  </style>
</head>
<body>

  <h1>üìã Lesson 3: Determinants & Inversion</h1>
  <p>Master the gatekeepers of matrix algebra for robust quant models.</p>

  <!-- Core Theory -->
  <div class="section">
    <h2>‚úÖ Core Theory</h2>
    <div class="card">
      <ul class="checklist">
        <li class="checklist-item"><input type="checkbox" id="theory1"><label for="theory1">Calculate 2x2 determinant: <span class="matrix-grid"><span class="matrix-cell">a</span><span class="matrix-cell">b</span><span class="matrix-cell">c</span><span class="matrix-cell">d</span></span> = ad - bc</label></li>
        <li class="checklist-item"><input type="checkbox" id="theory2"><label for="theory2">Apply Sarrus' rule for 3x3 determinants</label></li>
        <li class="checklist-item"><input type="checkbox" id="theory3"><label for="theory3">Prove: \( \det(AB) = \det(A)\det(B) \)</label></li>
        <li class="checklist-item"><input type="checkbox" id="theory4"><label for="theory4">Interpret determinant as volume scaling factor</label></li>
      </ul>
      <div class="warning">‚ö†Ô∏è <strong>Quant Pitfall:</strong> Near-zero determinants cause numerical instability in portfolio optimization.</div>
    </div>
  </div>

  <!-- Coding Skills -->
  <div class="section">
    <h2>üíª Coding Skills</h2>
    <div class="card">
      <ul class="checklist">
        <li class="checklist-item"><input type="checkbox" id="code1"><label for="code1">Compute determinants: <code>np.linalg.det(A)</code></label></li>
        <li class="checklist-item"><input type="checkbox" id="code2"><label for="code2">Check matrix invertibility: <code>if not np.isclose(np.linalg.det(A), 0)</code></label></li>
        <li class="checklist-item"><input type="checkbox" id="code3"><label for="code3">Implement manual 2x2/3x3 determinant calculation</label></li>
        <li class="checklist-item"><input type="checkbox" id="code4"><label for="code4">Handle singular matrices with try-catch blocks</label></li>
      </ul>
      <pre><code># Safe matrix inversion
def safe_inverse(A):
    if np.abs(np.linalg.det(A)) < 1e-10:
        raise ValueError("Near-singular matrix detected")
    return np.linalg.inv(A)</code></pre>
    </div>
  </div>

  <!-- Financial Applications -->
  <div class="section">
    <h2>üìà Financial Applications</h2>
    <div class="card">
      <div class="project-card">
        <h3>Project 1: Portfolio Optimization Safeguards</h3>
        <p>Protect Markowitz optimizer from singular matrices:</p>
        <pre><code>def robust_portfolio_weights(cov_matrix):
    if np.linalg.cond(cov_matrix) > 1e12:
        return np.ones(len(cov_matrix))/len(cov_matrix)
    return np.linalg.inv(cov_matrix) @ np.ones(len(cov_matrix))</code></pre>
        <ul class="checklist">
          <li class="checklist-item"><input type="checkbox" id="project1-1"><label for="project1-1">Implement condition number check</label></li>
          <li class="checklist-item"><input type="checkbox" id="project1-2"><label for="project1-2">Test with degenerate covariance matrices</label></li>
        </ul>
      </div>

      <div class="project-card">
        <h3>Project 2: Jacobian Determinant in Risk Transforms</h3>
        <pre><code>def transform_pdf(X, Y, jacobian):
    return X.pdf(Y) * np.abs(np.linalg.det(jacobian))</code></pre>
        <ul class="checklist">
          <li class="checklist-item"><input type="checkbox" id="project2-1"><label for="project2-1">Implement Black-Scholes to Local Vol transform</label></li>
          <li class="checklist-item"><input type="checkbox" id="project2-2"><label for="project2-2">Visualize density distortion</label></li>
        </ul>
      </div>
    </div>
  </div>

  <!-- Knowledge Validation -->
  <div class="section">
    <h2>üß† Knowledge Validation</h2>
    <div class="card">
      <ul class="checklist">
        <li class="checklist-item"><input type="checkbox" id="quiz1"><label for="quiz1">Diagnose why a portfolio optimizer failed (singular matrix case)</label></li>
        <li class="checklist-item"><input type="checkbox" id="quiz2"><label for="quiz2">Compute 3x3 determinant manually for given matrix</label></li>
        <li class="checklist-item"><input type="checkbox" id="quiz3"><label for="quiz3">Submit GitHub repo with robust covariance estimator</label></li>
      </ul>
    </div>
  </div>
<div class="section">
  <h2>üî• Quant-Level Final Challenges</h2>
  <div class="warning">
    ‚ö†Ô∏è Warning: These simulate real quant interview problems. Expect difficulty spikes.
  </div>

  <!-- Challenge 1 -->
  <div class="challenge-block">
    <h3>Challenge 1: Singular Covariance Crisis</h3>
    <p>Given this degenerate covariance matrix of asset returns:</p>
    <div class="math">
      $$
      \Sigma = \begin{bmatrix}
      0.04 & 0.02 & 0.04 \\
      0.02 & 0.01 & 0.02 \\
      0.04 & 0.02 & 0.04
      \end{bmatrix}
      $$
    </div>
    <ul class="checklist">
      <li>‚úÖ <strong>Prove</strong> singularity without computing det(Œ£)</li>
      <li>‚úÖ <strong>Modify</strong> Œ£ to make it positive definite while minimizing distortion</li>
    </ul>
    <button class="solution-btn" data-target="solution1">üìÇ Reveal Solution</button>
    <div id="solution1" class="solution-box">
<pre><code># Proof: Row 3 = 2 √ó Row 2 ‚Üí Linear dependence ‚Üí det(Œ£) = 0

# Correction using eigenvalue clipping:
import numpy as np
def fix_covariance(cov_matrix, epsilon=1e-5):
    eigvals, eigvecs = np.linalg.eigh(cov_matrix)
    eigvals = np.where(eigvals < epsilon, epsilon, eigvals)
    return eigvecs @ np.diag(eigvals) @ eigvecs.T
</code></pre>
      <p><strong>Key Insight:</strong> Detect singularity via linear dependence without determinant computation.</p>
    </div>
  </div>

  <!-- Challenge 2 -->
  <div class="challenge-block">
    <h3>Challenge 2: Determinant Intuition Test</h3>
    <p>For a 100x100 covariance matrix of S&amp;P 500 stocks:</p>
    <ul class="checklist">
      <li>‚úÖ <strong>Estimate</strong> log(det(Œ£)) within 10% error without full computation</li>
      <li>‚úÖ <strong>Explain</strong> why det(Œ£) ‚âà 0 even if no two assets are perfectly correlated</li>
    </ul>
    <button class="solution-btn" data-target="solution2">üìÇ Reveal Solution</button>
    <div id="solution2" class="solution-box">
<pre><code># Estimation technique using eigenvalue decay:
# 1. Take random sample of 10 eigenvalues
# 2. Compute mean log(Œª) and extrapolate:
log_det_estimate = n * np.mean(np.log(sampled_eigvals))

# Explanation:
# High-dimensional curse ‚Äî product of many Œª ‚âà 0 
# even if each correlation < 1 ‚Üí determinant collapses.
</code></pre>
      <p><strong>Quant Trick:</strong> Use random matrix theory to pre-approximate determinant scaling.</p>
    </div>
  </div>

  <!-- Challenge 3 -->
  <div class="challenge-block">
    <h3>Challenge 3: Numerical Stability Nightmare</h3>
<pre><code># Broken portfolio optimizer
def optimize(returns):
    cov = np.cov(returns.T)
    inv_cov = np.linalg.inv(cov)  # Crashes often!
    return inv_cov @ np.ones(len(cov))
</code></pre>
    <ul class="checklist">
      <li>‚úÖ <strong>Diagnose</strong> 3 hidden numerical risks (beyond det=0)</li>
      <li>‚úÖ <strong>Rewrite</strong> using SVD with condition number thresholding</li>
    </ul>
    <button class="solution-btn" data-target="solution3">üìÇ Reveal Solution</button>
    <div id="solution3" class="solution-box">
<pre><code># Hidden Risks:
# 1. Floating-point errors in np.cov() with small eigenvalues
# 2. Ill-conditioning when Œª_max/Œª_min > 1e16
# 3. Numerical instability in weight normalization

# Robust version:
def robust_optimize(returns, cond_thresh=1e8):
    cov = np.cov(returns.T)
    U, s, Vh = np.linalg.svd(cov)
    s_inv = np.where(s/s.max() > 1/cond_thresh, 1/s, 0)
    return Vh.T @ (np.diag(s_inv) @ (U.T @ np.ones(len(cov))))
</code></pre>
      <p><strong>Pro Tip:</strong> Always check condition number before inversion.</p>
    </div>
  </div>
</div>

<style>
.section {
  margin-bottom: 2rem;
}
.warning {
  background-color: rgba(255, 0, 0, 0.1);
  border-left: 3px solid red;
  padding: 0.8rem;
  margin-bottom: 1.5rem;
  color: red;
  font-weight: bold;
}
.challenge-block {
  border: 1px dashed yellow;
  padding: 1rem;
  margin-bottom: 1.5rem;
}
.checklist {
  margin-top: 0.5rem;
  margin-bottom: 0.5rem;
}
.solution-btn {
  margin-top: 0.5rem;
  background-color: gold;
  border: none;
  padding: 0.5rem 1rem;
  font-weight: bold;
  cursor: pointer;
}
.solution-box {
  display: none;
  background: rgba(0,255,204,0.05);
  border-left: 3px solid cyan;
  padding: 0.8rem;
  margin-top: 1rem;
  overflow: hidden;
  transition: max-height 0.4s ease-out, opacity 0.4s ease-out;
  max-height: 0;
  opacity: 0;
}
.solution-box.show {
  display: block;
  max-height: 800px;
  opacity: 1;
}
</style>
  <script>
    const requiredItems = {
      'project1-1': true,
      'project1-2': true,
      'project2-1': true
    };
    document.querySelectorAll('.checklist-item input').forEach(item => {
      item.addEventListener('change', function() {
        this.parentNode.classList.toggle('completed', this.checked);
        checkCompletion();
      });
    });
    function checkCompletion() {
      let allComplete = true;
      Object.keys(requiredItems).forEach(id => {
        if (!document.getElementById(id).checked) {
          allComplete = false;
        }
      });
      const btn = document.getElementById('completeBtn');
      const warning = document.getElementById('warningMsg');
      if (allComplete) {
        btn.style.backgroundColor = 'var(--secondary)';
        btn.textContent = "üöÄ Launch Eigen Decomposition!";
        warning.style.display = 'none';
      } else {
        btn.style.backgroundColor = 'var(--primary)';
        btn.textContent = "Complete Required Items First";
        warning.style.display = 'block';
      }
    }
    checkCompletion();
    document.querySelectorAll('.solution-btn').forEach(btn => {
      btn.addEventListener('click', function() {
        const target = this.getAttribute('data-target');
        const solution = document.getElementById(target);
        solution.style.display = solution.style.display === 'block' ? 'none' : 'block';
        this.textContent = solution.style.display === 'block' ? 'Hide Solution' : 'Reveal Solution';
      });
    });
  </script>
  <style>
.solution-box {
  display: none;
  background: rgba(0,255,204,0.05);
  border-left: 3px solid cyan;
  padding: 0.8rem;
  margin-top: 1rem;
  overflow: hidden;
  transition: max-height 0.4s ease-out, opacity 0.4s ease-out;
  max-height: 0;
  opacity: 0;
}
.solution-box.show {
  display: block;
  max-height: 800px; /* dostateƒçnƒõ velk√©, aby se ve≈°lo cel√© ≈ôe≈°en√≠ */
  opacity: 1;
}
</style>

<script>
document.addEventListener("DOMContentLoaded", function () {

  /* ===============================
     Reveal / Hide Solution buttons
     =============================== */
  document.querySelectorAll('.solution-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      const target = document.getElementById(btn.dataset.target);

      if (target.classList.contains('show')) {
        target.classList.remove('show');
        btn.textContent = 'üìÇ Reveal Solution';
      } else {
        target.classList.add('show');
        btn.textContent = 'üìÇ Hide Solution';
      }
    });
  });

  /* ==========================================
     Enhanced checklist with dependency checks
     ========================================== */
  const checklistRequiredItems = {
    'project1-1': true,
    'project1-2': true,
    'project2-1': true
  };

  document.querySelectorAll('.checklist-item input').forEach(item => {
    item.addEventListener('change', function () {
      this.parentNode.classList.toggle('completed', this.checked);
      checklistCheckCompletion();
    });
  });

  function checklistCheckCompletion() {
    let allComplete = true;
    Object.keys(checklistRequiredItems).forEach(id => {
      const element = document.getElementById(id);
      if (!element || !element.checked) {
        allComplete = false;
      }
    });

    const btn = document.getElementById('completeBtn');
    const warning = document.getElementById('warningMsg');

    if (btn && warning) {
      if (allComplete) {
        btn.style.backgroundColor = 'green';
        btn.textContent = "üöÄ Launch Eigen Decomposition!";
        warning.style.display = 'none';
      } else {
        btn.style.backgroundColor = 'gray';
        btn.textContent = "Complete Required Items First";
        warning.style.display = 'block';
      }
    }
  }

  // Spustit p≈ôi naƒçten√≠ str√°nky
  checklistCheckCompletion();
});
</script>

<div class="completion-rewards">
  <h3>üöÄ Completion Rewards</h3>
  <div class="rewards-box">
    <p>üîì Unlock: <strong>Eigen Decomposition</strong> (Lesson 4)</p>
    <p>üíº Portfolio: <strong>Numerical Stability Certificate</strong></p>
    <p>‚ö° XP: <strong>250 points</strong></p>

    <button id="completeBtn" class="completion-btn">Complete Required Items First</button>
    <p id="warningMsg" class="completion-warning">
      ‚ö† Complete all coding projects to unlock advanced lessons.
    </p>
  </div>
</div>

<style>
.completion-rewards {
  font-family: 'Press Start 2P', monospace;
  color: #00ffc8;
  margin-top: 2rem;
}
.completion-rewards h3 {
  font-size: 1.2rem;
  margin-bottom: 1rem;
}
.rewards-box {
  border: 2px solid #00ffc8;
  padding: 1rem;
  background-color: rgba(0, 255, 200, 0.05);
  border-radius: 6px;
}
.completion-btn {
  display: inline-block;
  padding: 0.6rem 1rem;
  background-color: gray;
  border: none;
  color: #000;
  font-size: 0.8rem;
  margin-top: 1rem;
  cursor: pointer;
}
.completion-btn:hover {
  filter: brightness(1.2);
}
.completion-warning {
  margin-top: 0.8rem;
  color: #ffd93b;
  font-size: 0.75rem;
}
</style>

</script>

</body>
</html>
